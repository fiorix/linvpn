-- version 3.0
Complete rewrite of previous version 2.5
